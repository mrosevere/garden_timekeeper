{% extends "core/base.html" %}
{% block content %}

<div class="container py-4">

    <!-- ---------------------------------------------------------
         Breadcrumb: Beds â†’ Bed Name
         --------------------------------------------------------- -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb small">
            <li class="breadcrumb-item">
                <a href="{% url 'bed_list' %}">Beds</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                {{ bed.name }}
            </li>
        </ol>
    </nav>

    <!-- ---------------------------------------------------------
         Page Title
         --------------------------------------------------------- -->
    <h1 class="h3 mb-4">{{ bed.name }}</h1>

    <div class="card shadow-sm">
        <div class="card-body">

            <!-- ---------------------------------------------------------
                 Two-column metadata layout (responsive)
                 --------------------------------------------------------- -->
            <dl class="row mb-0">

                <dt class="col-sm-3 fw-semibold">Location</dt>
                <dd class="col-sm-9">
                    {{ bed.location|default:"Not specified" }}
                </dd>

                <dt class="col-sm-3 fw-semibold">Plants</dt>
                <dd class="col-sm-9">
                    {{ bed.plants.count }} plant{{ bed.plants.count|pluralize }}
                </dd>

            </dl>

            <!-- ---------------------------------------------------------
                 Notes section (only shown if present)
                 --------------------------------------------------------- -->
            {% if bed.description %}
            <hr class="my-4">
            <h2 class="h6 mb-2">Notes</h2>

            <div class="border rounded p-3 bg-light notes-content">
                {{ bed.description|safe }}
            </div>
            {% endif %}

            <!-- ---------------------------------------------------------
                 Plants in this bed
                 --------------------------------------------------------- -->
            {% if bed.plants.exists %}
            <hr class="my-4">
            <h2 class="h6 mb-3">Plants in this Bed</h2>

            <ul class="list-group mb-3">
                {% for plant in bed.plants.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <a href="{% url 'plant_detail' plant.id %}">
                        {{ plant.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% endif %}

            <!-- ---------------------------------------------------------
                 Action buttons (mobile + desktop aware)
                 --------------------------------------------------------- -->
            <div class="mt-4 d-flex flex-column flex-sm-row justify-content-between gap-2">

                <!-- Left: Navigation -->
                <div class="d-flex flex-wrap gap-2 order-2 order-sm-1">
                    <a href="{% url 'bed_list' %}" class="btn btn-outline-secondary">
                        Back to Beds
                    </a>
                    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
                        Back to Dashboard
                    </a>
                </div>

                <!-- Right: Actions -->
                <div class="d-flex flex-wrap gap-2 order-1 order-sm-2 ms-sm-auto" style="align-self: flex-end;">
                    <a href="{% url 'bed_edit' bed.pk %}" class="btn btn-primary">
                        Edit Bed
                    </a>

                    <!-- Delete Button -->
                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                        Delete Bed
                    </button>
                </div>

            </div>

        </div>
    </div>
</div>

<!-- ---------------------------------------------------------
     Delete Confirmation Modal
     --------------------------------------------------------- -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h2 class="modal-title h5">Delete Garden Bed</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p>
                    Are you sure you want to delete <strong>{{ bed.name }}</strong>?
                </p>

                {% if bed.plants.exists %}
                <div class="alert alert-warning mt-3">
                    <strong>Warning:</strong>
                    This bed has <strong>{{ bed.plants.count }}</strong>
                    plant{{ bed.plants.count|pluralize }} assigned.
                    These plants will <strong>not</strong> be deleted, but they will
                    become <strong>unassigned</strong> and need reallocation.
                </div>

                <ul class="list-group mb-3">
                    {% for plant in bed.plants.all %}
                    <li class="list-group-item">{{ plant.name }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="modal-footer">
                <form method="post" action="{% url 'bed_delete' bed.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Yes, delete</button>
                </form>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancel
                </button>
            </div>

        </div>
    </div>
</div>

{% endblock %}
