{% extends "core/base.html" %} {% block content %}
<h1>Plant Details: {{ plant.name }}</h1>

<p><strong>Latin Name:</strong> {{ plant.latin_name|default:"Not specified" }}</p>
<p><strong>Lifespan:</strong>
  {% if plant.lifespan %}
    {{ plant.get_lifespan_display }}
  {% else %}
    Not specified
  {% endif %}
</p>
<p><strong>Type:</strong> 
  {% if plant.type %}
    {{ plant.get_type_display }}
  {% else %}
    Not specified
  {% endif %}
</p>
<p><strong>Planting Date:</strong> {{ plant.planting_date|date:"  F j, Y" }}</p>
<p><strong>Garden Bed:</strong>
  {% if plant.bed %}
    {{ plant.bed.name }}
  {% else %}
    Not specified
  {% endif %}
</p>
<p><strong>Notes:</strong> {{ plant.notes|linebreaksbr|default:"No additional notes" }}</p>


<!-- Return to plants button -->
<a href="{% url 'plant_list' %}" class="btn btn-secondary mt-3">Back to plants</a>

<!-- Edit Button -->
<a href="{% url 'plant_edit' plant.pk %}" class="btn btn-warning">Edit</a>

<!-- Delete Button with modal confirmation -->
<button
  class="btn btn-danger"
  data-bs-toggle="modal"
  data-bs-target="#deleteModal"
>
  Delete
</button>

<!-- Add Task Button -->
<a href="{% url 'task_create' plant.id %}" class="btn btn-primary btn-sm">
    Add Task
</a>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Garden Plant</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body">
        Are you sure you want to delete <strong>{{ plant.name }}</strong>?
      </div>

      <div class="modal-footer">
        <form method="post" action="{% url 'plant_delete' plant.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Yes, delete</button>
        </form>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Tasks for selected plant -->
<h3 class="mt-4">Tasks</h3>

<!-- If the plant has associated tasks, display a table view of the tasks -->
{% if task_info %}
  <div class="table-responsive">
    <table class="table table-striped align-middle mt-3">
      <thead>
        <tr>
          <th>Task</th>
          <th>Next Due</th>
          <th>Status</th>
          <th>Season</th>
          <th>Frequency</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in task_info %}
        {% with task=item.task %}
        <!-- Add logic into the row class based on task status -->
        <tr class="
        {% if task.is_overdue %}
            table-danger
        {% elif task.days_until_due <= 3 %}
            table-warning
        {% elif not item.in_season %}
            table-secondary
        {% endif %}">

          <!-- Task name -->
          <td>
            <strong>{{ task.name }}</strong>
          </td>

          <!-- Next due date -->
          <td>
            {{ task.next_due }}
          </td>

          <!-- Due status -->
          <td>
            {% if task.is_overdue %}
            <span class="badge bg-danger">Overdue</span>
            {% elif task.days_until_due <= 3 %}
              <span class="badge bg-warning text-dark">Due Soon</span>
            {% else %}
              <span class="badge bg-info text-dark">Scheduled</span>
            {% endif %}
          </td>

          <!-- Seasonal status -->
          <td>
            {% if item.in_season %}
              <span class="badge bg-success">In Season</span>
            {% else %}
              <span class="badge bg-secondary">Out of Season</span>
            {% endif %}
          </td>

          <!-- Frequency -->
          <td>
            {{ task.get_frequency_display }}
          </td>

          <!-- Action buttons -->
          <td class="text-end">
            <a href="{% url 'task_update' task.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <a href="{% url 'task_mark_done' task.id %}" class="btn btn-sm btn-success">Done</a>
            <a href="{% url 'task_skip' task.id %}" class="btn btn-sm btn-warning">Skip</a>
            <button 
              class="btn btn-sm btn-outline-danger"
              data-bs-toggle="modal"
              data-bs-target="#deleteTaskModal{{ task.id }}">
                Delete
            </button>

          </td>
        </tr>
      {% endwith %}
      {% endfor %}
      </tbody>
    </table>
  </div>

  {% for item in task_info %}
    {% with task=item.task %}
    <div class="modal fade" id="deleteTaskModal{{ task.id }}" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Delete Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    Are you sure you want to delete the task:
                    <strong>{{ task.name }}</strong>?
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form method="post" action="{% url 'task_delete' task.id %}">
                        {% csrf_token %}
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>

            </div>
        </div>
    </div>
    {% endwith %}
{% endfor %}

{% else %}
<p>No tasks yet.</p>
{% endif %}


{% endblock %}
