{% extends "core/base.html" %} {% block content %}
<div class="container py-4">
  <h1>Your Garden Plants</h1>

  <a href="{% url 'plant_create' %}" class="btn btn-primary mb-3">Add New Plant</a>

  <form method="get" class="row g-3 mb-4">

  <!-- Lifespan Filter -->
  <div class="col-md-3">
    <label class="form-label">Lifespan</label>
    <select name="lifespan" class="form-select">
      <option value="">All</option>
      {% for value, label in lifespan_choices %}
        <option value="{{ value }}" {% if request.GET.lifespan == value %}selected{% endif %}>
          {{ label }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Type Filter -->
  <div class="col-md-3">
    <label class="form-label">Type</label>
    <select name="type" class="form-select">
      <option value="">All</option>
      {% for value, label in type_choices %}
        <option value="{{ value }}" {% if request.GET.type == value %}selected{% endif %}>
          {{ label }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- Sort -->
  <div class="col-md-3">
    <label class="form-label">Sort by</label>
    <select name="sort" class="form-select">
      <option value="">Default</option>
      <option value="name" {% if request.GET.sort == "name" %}selected{% endif %}>Name (A–Z)</option>
      <option value="-name" {% if request.GET.sort == "-name" %}selected{% endif %}>Name (Z–A)</option>
      <option value="planting_date" {% if request.GET.sort == "planting_date" %}selected{% endif %}>Oldest first</option>
      <option value="-planting_date" {% if request.GET.sort == "-planting_date" %}selected{% endif %}>Newest first</option>
      <option value="bed__name" {% if request.GET.sort == "bed__name" %}selected{% endif %}>Bed (A–Z)</option>
      <option value="-bed__name" {% if request.GET.sort == "-bed__name" %}selected{% endif %}>Bed (Z–A)</option>
    </select>
  </div>

  <!-- Submit -->
  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100">Apply</button>
  </div>

  <!-- Reset -->
  <div class="col-md-1 d-flex align-items-end">
    <a href="{% url 'plant_list' %}" class="btn btn-outline-secondary w-100">Reset</a>
  </div>

</form>


  {% if plants %}
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Garden Bed</th>
        <th>Planting Date</th>
        <th style="width: 150px">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for plant in plants %}
      <tr>
        <td>
          <a href="{% url 'plant_detail' plant.pk %}"> {{ plant.name }} </a>
        </td>
        <td>{{ plant.bed|default:"—" }}</td>
        <td>{{ plant.planting_date|date:"Y-m-d" }}</td>
        <td>
          <a
            href="{% url 'plant_edit' plant.pk %}"
            class="btn btn-sm btn-outline-secondary me-2"
          >
            Edit
          </a>

          <!-- Delete modal trigger -->
          <button
            class="btn btn-sm btn-outline-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteModal-{{ plant.pk }}"
          >
            Delete
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- Delete modals -->
  {% for plant in plants %}
  <div
    class="modal fade"
    id="deleteModal-{{ plant.pk }}"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete Garden Plant</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body">
          Are you sure you want to delete <strong>{{ plant.name }}</strong>?
        </div>

        <div class="modal-footer">
          <form method="post" action="{% url 'plant_delete' plant.pk %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Yes, delete</button>
          </form>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %} {% else %}
  <p>You have no garden plants yet.</p>
  {% endif %}
</div>

{% endblock %}
